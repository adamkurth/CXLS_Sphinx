<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dectris-Eiger4M &mdash; CXLS Sphinx  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
      <link rel="stylesheet" href="_static/fonts.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Projects" href="waterbackground_subtraction_projects.html" />
    <link rel="prev" title="Agave Access" href="agave.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CXLS Sphinx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="home.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="agave.html">Agave Access</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dectris-Eiger4M</a></li>
<li class="toctree-l1"><a class="reference internal" href="#setup-and-operation">Setup and Operation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#accessing-the-dectris-menu">Accessing the Dectris Menu</a></li>
<li class="toctree-l2"><a class="reference internal" href="#activate-zmq-listener">Activate zmq Listener</a></li>
<li class="toctree-l2"><a class="reference internal" href="#steps">Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initializing-and-arming">Initializing and Arming</a></li>
<li class="toctree-l2"><a class="reference internal" href="#downloading-and-overwrite-images">Downloading and Overwrite Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#viewing-hdf5-images-through-reborn">Viewing HDF5 Images Through Reborn</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filtering-images">Filtering Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-agave">Using AGAVE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-slurm-in-agave">Working with Slurm in AGAVE</a></li>
<li class="toctree-l2"><a class="reference internal" href="#additional-notes">Additional Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="waterbackground_subtraction_projects.html">Projects</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CXLS Sphinx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Dectris-Eiger4M</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/cxls_eiger_4m.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dectris-eiger4m">
<h1>Dectris-Eiger4M</h1>
<p>This page contains documentaion for the operation of the Dectris Eiger4M detector. It includes steps for activating the zmq listener, initializing and arming the detector, troubleshooting, and additional resources for handling images and using AGAVE.</p>
</section>
<section id="setup-and-operation">
<h1>Setup and Operation</h1>
<section id="accessing-the-dectris-menu">
<h2>Accessing the Dectris Menu</h2>
<ul class="simple">
<li><p>Open <cite>http://10.139.1.5</cite> in any browser to access the Dectris menu options for the detector.</p></li>
<li><p>Data images will be stored at <cite>http://10.139.1.5/data/</cite>.</p></li>
<li><p>Use <cite>setup.sh</cite> to download these images onto your computer (details provided later in this document).</p></li>
</ul>
</section>
<section id="activate-zmq-listener">
<h2>Activate zmq Listener</h2>
<ol class="arabic simple" start="0">
<li><p>If not done already, please clone the reborn repository <cite>https://gitlab.com/kirianlab/reborn.git</cite>.</p></li>
</ol>
</section>
<section id="steps">
<h2>Steps</h2>
<ol class="arabic">
<li><p>Switch to develop branch:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>git<span class="w"> </span>checkout<span class="w"> </span>develop
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Navigate to the correct directory:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/labuser/Projects/Dectris/reborn/developer/rkirian/projects/cxls/dectris/fromzach/DEigerStream
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Activate <cite>reborn</cite> enviornment:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>activate<span class="w"> </span>reborn
</pre></div>
</div>
<ul class="simple">
<li><p>Note that this will activate the <cite>reborn</cite> conda enviornment.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Run <cite>DEigerStream.py</cite>: This will start the zmq listener, and display menu options for the detector.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>DEigerStream.py<span class="w"> </span>-i<span class="w"> </span><span class="m">10</span>.139.1.5<span class="w"> </span>-f<span class="w"> </span>junk.log
</pre></div>
</div>
<ul class="simple">
<li><p>Usually best to isolate this window in a separate terminal window.</p></li>
<li><p>The <cite>-i</cite> flag specifies the IP address of the detector.</p></li>
<li><p>The <cite>-f</cite> flag specifies the name of the log file.</p></li>
<li><p>If desired, to exit the zmq listener, press <cite>Ctrl+C</cite>.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
<section id="initializing-and-arming">
<h2>Initializing and Arming</h2>
<p>Next, initialize and arm the detector. This will allow you to control the detector using the zmq listener.</p>
<ol class="arabic">
<li><p>Source <cite>setup.sh</cite> to use simplified commands like initialize, arm, disarm, etc.:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>setup.sh
$<span class="w"> </span>initialize
</pre></div>
</div>
<ul class="simple">
<li><p>Note that this will initialize the detector, and return <cite>true</cite>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Set parameters and enable desired outputs using functions from <cite>setup.sh</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p>Choose from the options below:</p></li>
</ul>
<ul class="simple">
<li><p><cite>nimages</cite> sets the number of images collected in a series.</p></li>
<li><p><cite>frame_time</cite> sets the frame time (time between readouts or inverse of collection rate).</p></li>
<li><p><cite>count_time</cite> sets the exposure time.</p></li>
<li><p><cite>nimages_per_file</cite> sets the number of images per file.</p></li>
<li><p><cite>enable_monitor</cite> enables the monitor output.</p></li>
<li><p><cite>enable_stream</cite> enables the stream output.</p></li>
<li><p><cite>enable_filewriter</cite> enables the filewriter output.</p></li>
<li><p>Replace <cite>num</cite> argument with the desired number, for each function.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Able to check the options set using the following functions:</p>
<blockquote>
<div></div></blockquote>
</li>
</ol>
<ol class="arabic simple" start="3">
<li><p>Control the detector:</p></li>
</ol>
<blockquote>
<div></div></blockquote>
</section>
<section id="downloading-and-overwrite-images">
<h2>Downloading and Overwrite Images</h2>
<ol class="arabic">
<li><dl>
<dt>Navigate to the desired directory to store images:</dt><dd><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/labuser/Projects/Dectris/test/temp_data
</pre></div>
</div>
<ul class="simple">
<li><p>Note that this will download all images listed on <cite>http://10.139.1.5/data/</cite>.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Source the adapted setup script called <cite>adam_setup.sh</cite> and call the download function to start downloading images from <cite>http://10.139.1.5/data/</cite>:</p>
<blockquote>
<div><p>First,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>/home/labuser/Development/adam/vscode/dectris-eiger4m/Development/waterbackground_subtraction/adam_setup.sh
</pre></div>
</div>
<p>Then,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>adam_setup.sh
$<span class="w"> </span>download_images_from_IP
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="viewing-hdf5-images-through-reborn">
<h2>Viewing HDF5 Images Through Reborn</h2>
<ol class="arabic simple">
<li><p>Navigate to the recent downloaded images directory:</p></li>
</ol>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/labuser/Projects/Dectris/test/temp_data
</pre></div>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p>Export the Python path:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">export</span><span class="w"> </span><span class="nv">PYTHONPATH</span><span class="o">=</span>/home/labuser/Projects/Dectris/reborn/developer/rkirian/projects/cxls/dectris/fromzach/DEigerStream:<span class="nv">$PYTHONPATH</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Run <cite>test_h5_reading.py</cite> or any other Python file:</dt><dd><p>python test_h5_reading.py</p>
</dd>
</dl>
</li>
</ol>
</section>
<section id="troubleshooting">
<h2>Troubleshooting</h2>
<ul class="simple">
<li><p>If encountering module errors, check the modules available in reborn:
conda list</p></li>
<li><p>If a module is not installed, install using:
conda install &lt;modulename&gt;</p></li>
</ul>
</section>
<section id="filtering-images">
<h2>Filtering Images</h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/home/labuser/Development/adam/vscode/dectris-eiger4m/Development/waterbackground_subtraction/adam_setup.sh
</pre></div>
</div>
</section>
<section id="using-agave">
<h2>Using AGAVE</h2>
</section>
<section id="id1">
<h2>Steps</h2>
<ol class="arabic simple">
<li><dl class="simple">
<dt>On startup in AGAVE, get off the interactive node for computationally intensive tasks:</dt><dd><p>interactive</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Activate conda enviornment</dt><dd><p>source /home/&lt;username&gt;/anaconda3/bin/activate</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Manage modules in AGAVE:</dt><dd><ul class="simple">
<li><p>Check available modules:
module -l avail</p></li>
<li><p>Load a module:
module load &lt;module load&gt;/&lt;version number&gt;</p></li>
<li><p>Check loaded modules:
module list</p></li>
<li><p>Unload all modules
module purge</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</section>
<section id="working-with-slurm-in-agave">
<h2>Working with Slurm in AGAVE</h2>
<ul class="simple">
<li><p>Find partitions:
sinfo</p></li>
<li><p>Select output of only partition names:
sinfo -h –format=”%P”</p></li>
<li><p>Get detailed information of a specific partition:
sinfo -p &lt;partition_name&gt;</p></li>
<li><p>Watch tasks:
watch ‘squeue -u &lt;username&gt;’</p></li>
</ul>
</section>
<section id="additional-notes">
<h2>Additional Notes</h2>
<ul class="simple">
<li><p>Ensure you are following the specific protocols and safety measures associated with operating the Eiger4M detector.</p></li>
<li><p>this README is general guide, specific steps may vary.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="agave.html" class="btn btn-neutral float-left" title="Agave Access" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="waterbackground_subtraction_projects.html" class="btn btn-neutral float-right" title="Projects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sabine Botha, Adam Kurth, and more.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>