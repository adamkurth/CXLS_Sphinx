<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Water Background Subtraction (Overwrite) &mdash; CXLS Sphinx N documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CXLS Sphinx
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="background_subtraction.html">Imports</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_subtraction.html#peakthresholdprocessor-class">PeakThresholdProcessor Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_subtraction.html#arrayregion-class">ArrayRegion Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_subtraction.html#helper-functions">Helper Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_subtraction.html#coordinate-menu-function">Coordinate Menu Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="background_subtraction.html#main-function">Main Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="stream_background_subtraction.html">Water Background Subtraction Project (Stream)</a></li>
<li class="toctree-l1"><a class="reference internal" href="overwrite_background_subtraction.html">Water Background Subtraction (Overwrite)</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CXLS Sphinx</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Water Background Subtraction (Overwrite)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/overwrite.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="water-background-subtraction-overwrite">
<h1>Water Background Subtraction (Overwrite)<a class="headerlink" href="#water-background-subtraction-overwrite" title="Permalink to this headline"></a></h1>
<p>This module contains the adaptation of the previous background subtraction programs, called <cite>overwrite_10_2_23.py</cite>.
The rationale behind this is to take two stream files, one with “high” keV values and one with “low” keV values, and analyze their respective <cite>.stream</cite> files.
The program will then take the background from the “low” keV stream file and overwrite the background in the “high” keV stream file.</p>
<p>The program will then “overwrite” the “low” keV stream file, as the “high” keV stream, with the new more accurate peak values.</p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this headline"></a></h2>
<p>Most notably, we inherit the <cite>h5_stream_background_subtraction_10_2_23.py</cite> program, to simplify the code.
We also import <cite>os</cite>, <cite>shutil</cite>, <cite>numpy</cite>, and <cite>h5py</cite> as <cite>h5</cite>.</p>
</section>
<section id="duplicate-function">
<h2>Duplicate Function<a class="headerlink" href="#duplicate-function" title="Permalink to this headline"></a></h2>
<p>To compare the two stream files before and after the overwrite process, we need to duplicate the stream files.</p>
<p>We do this by using the <cite>shutil.copyfile()</cite> function, which takes two arguments, the source file and the destination file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">duplicate_before_overwrite</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Duplicate the specified file.</span>

<span class="sd">    :param filename: The name of the file to duplicate.</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :return: The path of the duplicated file.</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_file</span><span class="p">,</span> <span class="n">extension</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">new_base_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">base_file</span><span class="si">}</span><span class="s1">_copy&#39;</span>
    <span class="n">new_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">new_base_file</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">duplicate</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">duplicate</span>
</pre></div>
</div>
</section>
<section id="debugging-function">
<h2>Debugging Function<a class="headerlink" href="#debugging-function" title="Permalink to this headline"></a></h2>
<p>Used to compare the two stream files, used for debugging purposes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compare_high_low</span><span class="p">(</span><span class="n">high_data</span><span class="p">,</span> <span class="n">low_data</span><span class="p">,</span> <span class="o">*</span><span class="n">columns</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compare the high and low data and return the compared data.</span>

<span class="sd">    :param high_data: The high keV file to compare.</span>
<span class="sd">    :type high_data: dict</span>
<span class="sd">    :param low_data: The low keV file to compare.</span>
<span class="sd">    :type low_data: dict</span>
<span class="sd">    :param columns: The columns desired to be compared.</span>
<span class="sd">    :type columns: str</span>
<span class="sd">    :return: The columns desired to be compared.</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">compared_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">high_data</span> <span class="ow">and</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">low_data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;High: </span><span class="si">{</span><span class="n">high_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Low: </span><span class="si">{</span><span class="n">low_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">()</span>
            <span class="n">compared_data</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">high_data</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">low_data</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">compared_data</span>
</pre></div>
</div>
<p>This function directly appends certain columns in <cite>data_columns</cite> for ease of use and debugging purposes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">retrieve</span><span class="p">(</span><span class="n">data_columns</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve columns of data.</span>

<span class="sd">    :param data_columns: The columns of data to retrieve.</span>
<span class="sd">    :type data_columns: dict</span>
<span class="sd">    :param args: Takes the desired columns to be retrieved, appends to list.</span>
<span class="sd">    :type args: list</span>
<span class="sd">    :return: The columns of data to retrieve.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_columns</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">args</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data_columns</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</section>
<section id="overwrite-function">
<h2>Overwrite Function<a class="headerlink" href="#overwrite-function" title="Permalink to this headline"></a></h2>
<p>This function executes the overwriting procedure of the “high” keV stream file with the “low” keV stream file.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">overwrite_low_in_high</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">overwrite_data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Overwrite the low data in the high stream file with the given overwrite data.</span>

<span class="sd">    :param filename: The name of the file to overwrite.</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :param overwrite_data: A dictionary containing the data to overwrite.</span>
<span class="sd">    :type overwrite_data: dict</span>
<span class="sd">    :return: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c1"># Write code here to process the line and overwrite data</span>
            <span class="k">pass</span>
</pre></div>
</div>
</section>
<section id="intenstity-finder-function">
<h2>Intenstity Finder Function<a class="headerlink" href="#intenstity-finder-function" title="Permalink to this headline"></a></h2>
<p>This function simply finds the intensity of the peaks in the image, and returns a list of the intensities.
If the x,y coordinates are out of bounds, the function will simply ignore the peak.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">intensity_finder</span><span class="p">(</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">,</span> <span class="n">image_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Find the intensity of peaks in an image.</span>

<span class="sd">    :param x_coords: The x coordinates of the peaks.</span>
<span class="sd">    :type x_coords: list</span>
<span class="sd">    :param y_coords: The y coordinates of the peaks.</span>
<span class="sd">    :type y_coords: list</span>
<span class="sd">    :param image_name: The name of the image to find the intensity of the peaks.</span>
<span class="sd">    :type image_name: str</span>
<span class="sd">    :return: The intensity of the image.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Function implementation here</span>
</pre></div>
</div>
</section>
<section id="populate-intensity-array-function">
<h2>Populate Intensity Array Function<a class="headerlink" href="#populate-intensity-array-function" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">populate_intensity_array</span><span class="p">(</span><span class="n">data_columns</span><span class="p">,</span> <span class="n">image_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Populate the intensity array with intensity values.</span>

<span class="sd">    :param data_columns: The columns of data to populate.</span>
<span class="sd">    :type data_columns: dict</span>
<span class="sd">    :param image_name: The name of the image to populate the intensity array.</span>
<span class="sd">    :type image_name: str</span>
<span class="sd">    :return: The populated intensity array.</span>
<span class="sd">    :rtype: np.array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Function implementation here</span>
</pre></div>
</div>
</section>
<section id="main-function">
<h2>Main Function<a class="headerlink" href="#main-function" title="Permalink to this headline"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main function of the program, which executes the program.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Function implementation here</span>

    <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
        <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sabine Botha, Adam Kurth, and more.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>